<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat WhatsApp Style</title>
  <style>
body {
  background: #181920;
  color: #e9e9eb;
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 0;
  padding: 0;
}
#login {
  max-width: 320px;
  margin: 80px auto;
  background: #22232b;
  border-radius: 12px;
  box-shadow: 0 0 20px #0003;
  padding: 36px 28px;
  text-align: center;
}
header {
  background: #20232c;
  padding: 14px;
  text-align: center;
  border-bottom: 2px solid #222;
}
#chat-container {
  max-width: 480px;
  margin: 24px auto;
  border-radius: 10px;
  overflow: hidden;
  background: #23242c;
  box-shadow: 0 0 30px #00080038;
  display: flex;
  flex-direction: column;
  height: 80vh;
}
main#chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 18px;
  display: flex;
  flex-direction: column-reverse;
}
.mensagem {
  margin-bottom: 18px;
  padding: 10px 16px;
  border-radius: 18px 18px 4px 18px;
  background: #2b2c38;
  max-width: 78%;
  word-wrap: break-word;
  font-size: 1rem;
  display: inline-block;
}
.mensagem.eu {
  background: #005c4b;
  color: #fff;
  align-self: flex-end;
  border-radius: 18px 18px 18px 4px;
}
main img {
  max-width: 220px;
  border-radius: 12px;
  display: block;
  margin-top: 7px;
}
footer {
  display: flex;
  align-items: center;
  background: #23242c;
  padding: 12px;
  border-top: 2px solid #20232c;
}
footer input[type="text"] {
  flex: 1;
  padding: 8px 12px;
  border: none;
  border-radius: 9px;
  background: #191b24;
  color: #fafafa;
  outline: none;
  font-size: 1rem;
}
footer button {
  margin-left: 10px;
  padding: 7px 19px;
  font-size: 1rem;
  border-radius: 8px;
  border: none;
  background: #3dd77a;
  color: #121212;
  cursor: pointer;
  font-weight: bold;
}
.upload-label {
  margin-left: 10px;
  font-size: 1.25rem;
  cursor: pointer;
}
.upload-label input[type="file"] {
  display: none;
}
@media (max-width: 600px) {
  #chat-container, #login { max-width: 98vw; }
  main#chat-messages { font-size: .96rem; }
}
  </style>
</head>
<body>
  <div id="login">
    <h2>Digite a senha para acessar o chat</h2>
    <input type="password" id="senha" placeholder="Senha..." />
    <button onclick="entrarChat()">Entrar</button>
    <p id="erro-senha" style="color:#e55;display:none;">Senha incorreta!</p>
  </div>

  <div id="chat-container" style="display:none;">
    <header>
      <h1>Chat Box</h1>
    </header>
    <main id="chat-messages"></main>
    <footer>
      <input type="text" id="texto-mensagem" placeholder="Digite uma mensagem..." autocomplete="off" />
      <label class="upload-label" title="Enviar imagem">
        ðŸ“·
        <input type="file" id="upload-img" accept="image/*">
      </label>
      <button onclick="enviarMensagem()">Enviar</button>
    </footer>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <script>
    // ==== CONFIGURAR AQUI ====
    const firebaseConfig = {
      apiKey: "AIzaSyD3UaOcnpccKTDA1Xoc-oQoxvzvNnvevtg",
      authDomain: "chat-8e326.firebaseapp.com",
      databaseURL: "https://chat-8e326-default-rtdb.firebaseio.com",
      projectId: "chat-8e326",
      storageBucket: "chat-8e326.firebasestorage.app",
      messagingSenderId: "1052146549817",
      appId: "1:1052146549817:android:d64a25191233895f4db9e8"
    };
    // Sua chave de API ImgBB:
    const IMGBB_API_KEY = "f81413a49f753a0d70b7cdb3fd2dc9"; // troque se quiser outra chave
    const SENHA_CORRETA = "2000";
    // =================

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatRef = db.ref("chats/global/messages");
    let usuario = "UsuÃ¡rio" + Math.floor(Math.random()*1000);

    window.entrarChat = function() {
      const senha = document.getElementById("senha").value;
      if (senha === SENHA_CORRETA) {
        document.getElementById("login").style.display = "none";
        document.getElementById("chat-container").style.display = "";
      } else {
        document.getElementById("erro-senha").style.display = "";
      }
    }

    function renderizarMensagem(msg, eu) {
      const div = document.createElement('div');
      div.className = "mensagem" + (eu ? " eu" : "");
      if (msg.text) {
        div.textContent = msg.text;
      }
      if (msg.imageUrl) {
        if(msg.text) div.appendChild(document.createElement('br'));
        const img = document.createElement('img');
        img.src = msg.imageUrl;
        img.alt = "imagem enviada";
        div.appendChild(img);
      }
      if (msg.sender) {
        div.title = msg.sender + " â€¢ " + new Date(msg.timestamp).toLocaleTimeString();
      }
      return div;
    }

    const chatBox = document.getElementById("chat-messages");
    chatRef.orderByChild("timestamp").limitToLast(50).on("value", snapshot => {
      chatBox.innerHTML = "";
      const mensagens = [];
      snapshot.forEach(child => {
        mensagens.push(child.val());
      });
      mensagens.reverse();
      mensagens.forEach(msg => {
        chatBox.appendChild(renderizarMensagem(msg, msg.sender==usuario));
      });
    });

    window.enviarMensagem = async function () {
      const input = document.getElementById("texto-mensagem");
      const texto = input.value;
      if (texto.trim() === "") return;
      const msgObj = {
        text: texto,
        imageUrl: null,
        sender: usuario,
        timestamp: Date.now()
      };
      await chatRef.push(msgObj);
      input.value = "";
    }

    document.getElementById("upload-img").addEventListener("change", async function(e){
      const file = e.target.files[0];
      if (!file) return;
      const formData = new FormData();
      formData.append('key', IMGBB_API_KEY);
      formData.append('image', file);
      try {
        const resp = await fetch("https://api.imgbb.com/1/upload", { method: "POST", body: formData });
        const data = await resp.json();
        if (data && data.data && data.data.url) {
          const msgObj = {
            text: "",
            imageUrl: data.data.url,
            sender: usuario,
            timestamp: Date.now()
          };
          await chatRef.push(msgObj);
        } else {
          alert("Falha ao enviar imagem!");
        }
      } catch (err) {
        alert("Erro no upload da imagem: " + err.message);
      }
      e.target.value = "";
    });
  </script>
</body>
</html>
